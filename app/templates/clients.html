<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <title>Clients Lijst</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style_clients.css') }}">

    <style>
        .dropdown { position: relative; display: inline-block; }
        .dropdown-menu {
            display: none;
            position: absolute;
            background: white;
            border: 1px solid #ccc;
            padding: 12px;
            z-index: 10;
            border-radius: 8px;
        }
        .dropdown-option { 
            display: block; 
            margin: 6px 0; 
            cursor: pointer;
            background: none;
            border: none;
            text-align: left;
            width: 100%;
        }
        .filter-options label { 
            display: block; 
            margin-bottom: 8px; 
        }
        .filter-menu input, 
        .filter-menu select {
            width: 100%;
            padding: 6px;
            margin-top: 3px;
        }
        .filter-actions {
            margin-top: 10px;
            display: flex;
            gap: 8px;
        }
        .filter-actions button {
            flex: 1;
            padding: 6px;
        }
    </style>
</head>

<body>

<div class="clients-container">

    <div class="page-header">
        <img src="{{ url_for('static', filename='logo.svg') }}" alt="Liq logo" class="logo">

        <h1>Clients Lijst</h1>

        <div class="action-group">

            <!-- SORT -->
            <div class="dropdown">
                <button class="action-button" id="sortButton">Sorteer</button>
                <div class="dropdown-menu" id="sortMenu">
                    <button class="dropdown-option" data-sort="name-asc">Naam A → Z</button>
                    <button class="dropdown-option" data-sort="name-desc">Naam Z → A</button>
                    <button class="dropdown-option" data-sort="rev-asc">Revenue klein → groot</button>
                    <button class="dropdown-option" data-sort="rev-desc">Revenue groot → klein</button>
                    <button class="dropdown-option" data-sort="default">Standaard</button>
                </div>
            </div>

            <!-- FILTER -->
            <div class="dropdown">
                <button class="action-button" id="filterButton">Filter</button>
                <div class="dropdown-menu filter-menu" id="filterMenu">

                    <p><strong>Filter op kolom</strong></p>

                    <div class="filter-options">

                        <label>Naam
                            <input type="text" id="filterName">
                        </label>

                        <label>Land
                            <select id="filterCountry">
                                <option value="">-- Alle landen --</option>
                                {% for country in countries %}
                                    <option value="{{ country | lower }}">{{ country }}</option>
                                {% endfor %}
                            </select>
                        </label>

                        <label>Min Revenue
                            <input type="number" id="filterRevenueMin">
                        </label>

                        <label>Max Revenue
                            <input type="number" id="filterRevenueMax">
                        </label>

                    </div>

                    <div class="filter-actions">
                        <button type="button" id="filterApply">Apply</button>
                        <button type="button" id="filterClear">Clear</button>
                    </div>

                </div>
            </div>

        </div>
    </div>

    <!-- TABEL -->
    <div class="table-wrapper">
        <table id="clientsTable" class="webusers-table">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Country</th>
                    <th>Total Revenue</th>
                    <th>Production Cost</th>
                    <th>Transport</th>
                    <th>Storage</th>
                    <th>Actie</th>
                </tr>
            </thead>
            <tbody>
                {% for c in clients %}
                    {% set totals = client_totals[c.CLIENT_ID] %}
                    <tr class="client-row"
                        data-name="{{ c.Name | lower }}"
                        data-country="{{ c.Country | lower }}"
                        data-revenue="{{ totals.total_revenue }}">

                        <td>{{ c.Name }}</td>
                        <td>{{ c.Country }}</td>
                        <td>{{ totals.total_revenue }}</td>
                        <td>{{ totals.total_production_cost }}</td>
                        <td>{{ totals.total_transport_cost }}</td>
                        <td>{{ totals.total_storage_cost }}</td>

                        <td>
                            <a href="{{ url_for('main.delete_client', id=c.CLIENT_ID) }}"
                               onclick="return confirm('Zeker dat je deze client wil verwijderen?');"
                               class="delete-btn">Delete</a>
                        </td>

                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <button class="back-button" onclick="window.location.href='/home'">Terug</button>

</div>


<!-- SCRIPT -->
<script>

    const sortButton = document.getElementById("sortButton");
    const sortMenu = document.getElementById("sortMenu");
    const filterButton = document.getElementById("filterButton");
    const filterMenu = document.getElementById("filterMenu");

    function toggle(menu) {
        menu.style.display = menu.style.display === "block" ? "none" : "block";
    }

    // MENU LOGICA
    sortButton.onclick = e => { 
        e.stopPropagation(); 
        toggle(sortMenu); 
        filterMenu.style.display="none"; 
    };

    filterButton.onclick = e => { 
        e.stopPropagation(); 
        toggle(filterMenu); 
        sortMenu.style.display="none"; 
    };

    // prevent closing when clicking INSIDE menus
    sortMenu.onclick = event => event.stopPropagation();
    filterMenu.onclick = event => event.stopPropagation();

    // close menus when clicking outside
    document.onclick = () => { 
        sortMenu.style.display="none"; 
        filterMenu.style.display="none"; 
    };

    const tableBody = document.querySelector("#clientsTable tbody");
    const rows = Array.from(document.querySelectorAll(".client-row"));
    const defaultOrder = [...rows];


    /* ---- SORTEREN ---- */
    document.querySelectorAll("#sortMenu .dropdown-option").forEach(btn => {
        btn.onclick = () => {
            let type = btn.dataset.sort;
            let sorted = [...rows];

            if (type === "name-asc") {
                sorted.sort((a,b)=>a.dataset.name.localeCompare(b.dataset.name));
            } 
            else if (type === "name-desc") {
                sorted.sort((a,b)=>b.dataset.name.localeCompare(a.dataset.name));
            } 
            else if (type === "rev-asc") {
                sorted.sort((a,b)=>a.dataset.revenue - b.dataset.revenue);
            } 
            else if (type === "rev-desc") {
                sorted.sort((a,b)=>b.dataset.revenue - a.dataset.revenue);
            } 
            else {
                sorted = defaultOrder;
            }

            sorted.forEach(r => tableBody.appendChild(r));
            sortMenu.style.display = "none";
        };
    });


    /* ---- FILTEREN ---- */
    document.getElementById("filterApply").onclick = () => {

        const name = document.getElementById("filterName").value.toLowerCase();
        const country = document.getElementById("filterCountry").value.toLowerCase();
        const revMin = document.getElementById("filterRevenueMin").value;
        const revMax = document.getElementById("filterRevenueMax").value;

        rows.forEach(r => {
            const rn = r.dataset.name;
            const rc = r.dataset.country;
            const rr = Number(r.dataset.revenue);

            const ok =
                (!name || rn.includes(name)) &&
                (!country || rc === country) &&
                (!revMin || rr >= Number(revMin)) &&
                (!revMax || rr <= Number(revMax));

            r.style.display = ok ? "" : "none";
        });

        filterMenu.style.display = "none";
    };


    /* ---- CLEAR FILTER ---- */
    document.getElementById("filterClear").onclick = () => {
        document.querySelectorAll("#filterMenu input").forEach(i => i.value = "");
        document.getElementById("filterCountry").value = "";
        rows.forEach(r => r.style.display = "");
    };

</script>

</body>
</html>


