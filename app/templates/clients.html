<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <title>Clients List</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style_clients.css') }}">

    <style>
        .top-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 15px;
            margin-bottom: 10px;
        }

        .logo-link {
            display: inline-flex;
            align-items: center;
        }

        .compact-button {
            background-color: #a86b45;
            padding: 10px 18px;
            border-radius: 10px;
            color: white;
            font-weight: bold;
            border: none;
            cursor: pointer;
        }
        .compact-button:hover {
            background-color: #8c4e28;
        }

        /* Popup Panels */
        .popup-panel {
            position: absolute;
            right: 40px;
            top: 150px;
            width: 260px;
            padding: 15px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.15);
            display: none;
            z-index: 100;
        }

        .popup-panel input, .popup-panel select {
            width: 100%;
            margin-bottom: 10px;
            padding: 6px;
            border-radius: 6px;
            border: 1px solid #ccc;
        }

        .popup-panel button {
            width: 48%;
            padding: 7px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-weight: bold;
        }

        .apply-btn { background-color: #a86b45; color: white; }
        .reset-btn { background-color: #ddd; }
    </style>

    <script>
        function togglePanel(id) {
            hideAllPanels();
            const p = document.getElementById(id);
            p.style.display = (p.style.display === "block" ? "none" : "block");
        }

        function toggleFilter() { togglePanel("filter-panel"); }
        function toggleSort()   { togglePanel("sort-panel"); }
        function toggleAdjust() { togglePanel("adjust-panel"); }

        function hideAllPanels() {
            const ids = ["filter-panel", "sort-panel", "adjust-panel"];
            ids.forEach(i => {
                const el = document.getElementById(i);
                if (el) el.style.display = "none";
            });
        }

        // CLICK OUTSIDE PANELS TO CLOSE
        document.addEventListener("click", function(e) {
            const panels = ["filter-panel", "sort-panel", "adjust-panel"];
            const clickedInside = panels.some(id => {
                const p = document.getElementById(id);
                return p && p.contains(e.target);
            });

            const isButton = e.target.classList.contains("compact-button");

            if (!clickedInside && !isButton) {
                hideAllPanels();
            }
        });
    </script>
</head>

<body>

<div class="clients-container">

    <!-- HEADER -->
    <div class="page-header">
        <a href="{{ url_for('main.home_page') }}" class="logo-link">
            <img src="{{ url_for('static', filename='logo.svg') }}" class="logo" alt="Liq logo">
        </a>
        <h1>Clients List</h1>


        <div class="top-buttons">
            <button class="compact-button" onclick="window.location.href='/home'">Home</button>
            <button class="compact-button" onclick="window.location.href='/forecast'">Forecast</button>
            <button class="compact-button" onclick="toggleFilter()">Filter</button>
            <button class="compact-button" onclick="toggleSort()">Sorteer</button>
            <button class="compact-button" onclick="toggleAdjust()">Adjust</button>
        </div>
    </div>

    <button class="back-button" onclick="window.location.href='/home'">Terug</button>

    <!-- FILTER PANEL -->
    <div id="filter-panel" class="popup-panel">
        <form method="get">

            <label>Naam:</label>
            <input type="text" name="name" value="{{ request_args.get('name','') }}">

            <label>Land:</label>
            <select name="country">
                <option value="">-- Alle landen --</option>
                {% for country in countries %}
                    <option value="{{ country|lower }}"
                        {% if request_args.get('country','') == country|lower %} selected {% endif %}>
                        {{ country }}
                    </option>
                {% endfor %}
            </select>

            <label>Min Revenue:</label>
            <input type="number" name="min_rev" value="{{ request_args.get('min_rev','') }}">

            <label>Max Revenue:</label>
            <input type="number" name="max_rev" value="{{ request_args.get('max_rev','') }}">

            <div style="display:flex; justify-content:space-between; margin-top:10px;">
                <button type="submit" class="apply-btn">Apply</button>
                <a href="/clients" class="reset-btn">Clear</a>
            </div>
        </form>
    </div>

    <!-- SORT PANEL -->
    <div id="sort-panel" class="popup-panel">
        <form method="get">

            <input type="hidden" name="name" value="{{ request_args.get('name','') }}">
            <input type="hidden" name="country" value="{{ request_args.get('country','') }}">
            <input type="hidden" name="min_rev" value="{{ request_args.get('min_rev','') }}">
            <input type="hidden" name="max_rev" value="{{ request_args.get('max_rev','') }}">

            <label>Sorteer op:</label>
            <select name="sort">
                <option value="default">Standaard</option>
                <option value="name-asc">Naam A → Z</option>
                <option value="name-desc">Naam Z → A</option>
                <option value="rev-asc">Revenue klein → groot</option>
                <option value="rev-desc">Revenue groot → klein</option>
            </select>

            <div style="display:flex; justify-content:space-between; margin-top:10px;">
                <button type="submit" class="apply-btn">Apply</button>
                <a href="/clients" class="reset-btn">Clear</a>
            </div>
        </form>
    </div>

    <!-- ADJUST PANEL -->
    <div id="adjust-panel" class="popup-panel">
        <h3>Adjust Clients</h3>

        <!-- ADD -->
        <form method="post" action="/clients/add" style="margin-bottom:15px;">
            <h4>Add Client</h4>
            <input name="name" placeholder="Name" required>
            <input name="country" placeholder="Country" required>
            <input name="postal_code" placeholder="Postal Code">
            <input name="city" placeholder="City">
            <input name="street" placeholder="Street">
            <input name="house_number" placeholder="House Number">

            <button type="submit" class="apply-btn">Add</button>
        </form>

        <hr>

        <!-- DELETE -->
        <form method="post" action="/clients/delete_by_name">
            <h4>Delete Client</h4>
            <input name="name" placeholder="Client Name" required>

            <button type="submit" class="apply-btn" style="background-color:#d9534f;">Delete</button>
        </form>
    </div>

    <!-- TABLE -->
    <div class="table-wrapper">
        <table class="webusers-table">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Country</th>
                    <th>Total Revenue</th>
                    <th>Production Cost</th>
                    <th>Transport Cost</th>
                    <th>Storage Cost</th>
                </tr>
            </thead>
            
            <tbody>
                {% for c in clients %}
                    {% set totals = client_totals[c.CLIENT_ID] %}
                    <tr>
                        <td>{{ c.Name }}</td>
                        <td>{{ c.Country }}</td>
                        <td>{{ totals.total_revenue }}</td>
                        <td>{{ totals.total_production_cost }}</td>
                        <td>{{ totals.total_transport_cost }}</td>
                        <td>{{ totals.total_storage_cost }}</td>
                    </tr>
                {% endfor %}
            </tbody>

        </table>
    </div>

</div>

</body>
</html>












